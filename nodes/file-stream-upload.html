<!-- file-stream-upload.html -->
<script type="text/javascript">
  RED.nodes.registerType('file-stream-upload', {
    category: 'storage',
    color: '#E6E0F8',
    defaults: {
      name: { value: '' },
      directory: { value: '/data/upload-stream', required: true },
    },
    inputs: 1,
    outputs: 1,
    icon: 'font-awesome/fa-file-o',
    label: function () {
      return this.name || 'file-stream-upload';
    },
  });
</script>

<script type="text/x-red" data-template-name="file-stream-upload">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-directory"><i class="fa fa-folder"></i> Directory</label>
        <input type="text" id="node-input-directory" placeholder="/data/upload-stream">
    </div>
</script>

<script type="text/x-red" data-help-name="file-stream-upload">
    <p>Saves a file stream to a specified directory on the local filesystem.</p>
    <p>This node is designed to work with the <code>stream-upload</code> node or any other node that provides a readable stream in <code>msg.payload</code>.</p>

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">stream</span>
        </dt>
        <dd>The readable stream of the file to be saved.</dd>
        <dt>filename
            <span class="property-type">string</span>
        </dt>
        <dd>(Optional) The original name of the file. Used to create the new, unique filename.</dd>
    </dl>

    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">object</span>
        </dt>
        <dd>An object containing details about the saved file.</dd>
    </dl>
    <h4>Payload Object</h4>
    <dl class="message-properties">
        <dt>path
            <span class="property-type">string</span>
        </dt>
        <dd>The full absolute path to the newly saved file.</dd>
        <dt>filename
            <span class="property-type">string</span>
        </dt>
        <dd>The new, unique filename (including a UUID) of the saved file.</dd>
        <dt>originalFilename
            <span class="property-type">string</span>
        </dt>
        <dd>The original filename as received in the input message.</dd>
    </dl>

    <h3>Details</h3>
    <p>The node ensures the destination directory exists before writing. To prevent filename collisions, it generates a unique filename by prepending a UUID to the original filename.</p>
</script>
